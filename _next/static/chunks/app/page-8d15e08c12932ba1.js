(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{22769:function(e,t,n){Promise.resolve().then(n.bind(n,3354))},3354:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(57437),o=n(55606),l=n(28811),a=n.n(l),s=n(2265),i=n(54887),c=n(94660),d=n(74810);async function openDB(){return new Promise((e,t)=>{let n=indexedDB.open("myDatabase",1);n.onerror=e=>t(e.target.errorCode),n.onupgradeneeded=e=>{let t=e.target.result;t.createObjectStore("history",{keyPath:"id",autoIncrement:!0})},n.onsuccess=t=>e(t.target.result)})}async function readFromDB(){let e=await openDB();return new Promise(t=>{let n=e.transaction(["history"],"readonly"),r=n.objectStore("history"),o=r.getAll();o.onsuccess=()=>{t(o.result)}})}async function writeToDB(e){let t=await openDB(),n=t.transaction(["history"],"readwrite"),r=n.objectStore("history");r.add(e)}let u={getItem:async e=>{let t=await readFromDB();return t.filter(t=>t.key===e)},setItem:async(e,t)=>{await writeToDB({key:e,value:t})},removeItem:async e=>{}},m=(0,c.ZP)()((0,d.mW)(e=>{var t,n;return{aiInfo:(null===(t=localStorage)||void 0===t?void 0:t.getItem("aiInfo"))?JSON.parse(null===(n=localStorage)||void 0===n?void 0:n.getItem("aiInfo")):{base_url:"https://api.openai.com/v1/chat/completions",key:"",systemPrompt:'# Role: Tailwind CSS Developer\n\n## Task\n\n- Input: Screenshot(s) of a reference web page or Low-fidelity\n- Output: Single HTML page using Tailwind CSS, HTML\n\n## Guidelines\n\n- Utilize Tailwind CSS to develop the website based on the provided screenshot or Low-fidelity\n- Achieve an exact visual match to the provided screenshot or Low-fidelity\n- Pay close attention to:\n  - Background color\n  - Text color\n  - Font size\n  - Font family\n  - Padding\n  - Margin\n  - Border\n- Use the precise text from the screenshot\n- Avoid placeholder comments; write the full code\n- Repeat elements as shown in the screenshot (e.g., if there are 15 items, include 15 items in the code)\n- Use placeholder images from `https://placehold.co` with descriptive `alt` text for future image generation\n\n## Libraries\n\n- Include Tailwind CSS via: `<script src="https://cdn.tailwindcss.com"></script>`\n\n## Deliverable\n\n- Respond with the complete HTML code within `<html>` tags\n- Respond with the HTML file content only\n          ',userPrompt:"Turn this into a single html file using tailwind."},setAiInfo:t=>{e(e=>{var n;let r={aiInfo:{...e.aiInfo,...t}};return null===(n=localStorage)||void 0===n||n.setItem("aiInfo",JSON.stringify(r.aiInfo)),r})},history:[],addRecord:t=>{e(e=>({history:[...e.history,t]})),u.setItem("history-storage",t)},loadHistory:async()=>{let t=await u.getItem("history-storage");console.log(t,"data"),e(()=>({history:t.map(e=>null==e?void 0:e.value)}))}}},{name:"ai-code"}));function getGlobalStore(){return m.getState()}async function getResponseFromAPI(e){let t=getGlobalStore().aiInfo.base_url,n=getGlobalStore().aiInfo.key,r=getGlobalStore().aiInfo.systemPrompt,o=getGlobalStore().aiInfo.userPrompt;if(!t||!n)throw Error("Please set the API endpoint and key first.");let l=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({model:"gpt-4-vision-preview",max_tokens:4096,messages:[{role:"system",content:r},{role:"user",content:[{type:"image_url",image_url:{url:e}},{text:o,type:"text"}]}]})}),a=await l.json();return a.choices[0].message.content}var h=n(42744),g=n.n(h),f=n(84988);function PreviewModal(e){let{codeItem:t,onHandleClose:n}=e,[o,l]=(0,s.useState)("preview"),[a,i]=(0,s.useState)("desktop");(0,s.useEffect)(()=>{},[t,o]);let[c,d]=(0,s.useState)();return((0,s.useEffect)(()=>{(0,f.CZ)(t.html,{lang:"html",theme:"nord"}).then(e=>{d(e)})},[]),t)?(0,r.jsxs)("div",{onClick:e=>{e.stopPropagation()},className:"bg-white rounded-lg shadow-xl flex flex-col",style:{width:"calc(100% - 64px)",height:"calc(100% - 64px)"},children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)(TabButton,{active:"image"===o,onClick:()=>{l("image")},children:"草图"}),(0,r.jsx)(TabButton,{active:"preview"===o,onClick:()=>{l("preview")},children:"代码预览"}),(0,r.jsx)(TabButton,{active:"code"===o,onClick:()=>{l("code")},children:"代码"})]}),(0,r.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-200 focus:outline-none focus:ring",onClick:n,children:(0,r.jsx)("svg",{className:"w-6 h-6 text-gray-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),"preview"===o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-full flex justify-center",children:[(0,r.jsx)("button",{className:"w-[50px] bg-slate-400 m-2",onClick:()=>{i("desktop")},children:"pc"}),(0,r.jsx)("button",{className:"w-[50px] bg-slate-400 m-2",onClick:()=>{i("mobile")},children:"mobile"})]}),(0,r.jsx)("div",{className:"w-full flex justify-center",children:(0,r.jsx)("iframe",{className:g()("border-[4px] border-black rounded-[20px] shadow-lg","transform scale-[0.9] origin-top",{"w-full h-[832px]":"desktop"===a,"w-[450px] h-[832px]":"mobile"===a}),srcDoc:t.html})})]}),"code"===o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(t.html),alert("已拷贝代码")},children:"代码拷贝"}),(0,r.jsx)("div",{style:{overflow:"auto"},dangerouslySetInnerHTML:{__html:null!=c?c:""}})]}),"image"===o&&(0,r.jsx)("div",{className:"flex justify-center items-center w-full h-full overflow-auto",children:(0,r.jsx)("img",{src:t.png,alt:"",className:"w-full h-full object-contain"})})]}):null}function TabButton(e){let{active:t,...n}=e;return(0,r.jsx)("button",{className:t?"px-4 py-2 text-sm font-medium text-white bg-blue-500 rounded-t-md focus:outline-none focus:ring":"px-4 py-2 text-sm font-medium text-blue-500 bg-transparent hover:bg-blue-100 focus:bg-blue-100 rounded-t-md focus:outline-none focus:ring",...n})}function blobToBase64(e){return new Promise((t,n)=>{let r=new FileReader;r.onloadend=()=>t(r.result),r.readAsDataURL(e)})}var x=n(45965);let p=null;function getBrowserCanvasMaxSize(){return p||(p=calculateBrowserCanvasMaxSize()),p}async function calculateBrowserCanvasMaxSize(){let e=await x.default.maxWidth({usePromise:!0}),t=await x.default.maxHeight({usePromise:!0}),n=await x.default.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}let b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(b=new Int32Array(b));let crc=(e,t)=>{let n=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)n=b[(n^e[t])&255]^n>>>8;return -1^n};let PngHelpers=class PngHelpers{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={};if(!PngHelpers.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let r=t,o=e.getInt32(t);t+=4;let l=PngHelpers.getChunkType(e,t);if("IDAT"===l&&n[l]){t+=o+4+4;continue}if("IEND"===l)break;n[l]={start:r,dataOffset:t+4,size:o},t+=o+4+4}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){let n=PngHelpers.readChunks(e);return n[t]}static setPhysChunk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=46,o=0,l=PngHelpers.findChunk(e,"pHYs");l&&(r=l.start,o=l.size);let a=PngHelpers.findChunk(e,"IDAT");a&&(r=a.start,o=0);let s=new ArrayBuffer(21),i=new DataView(s);i.setUint32(0,9),i.setUint8(4,112),i.setUint8(5,72),i.setUint8(6,89),i.setUint8(7,115),i.setInt32(8,2835.5*t),i.setInt32(12,2835.5*t),i.setInt8(16,1);let c=new Uint8Array(s.slice(4,17));i.setInt32(17,crc(c));let d=e.buffer.slice(0,r),u=e.buffer.slice(r+o);return new Blob([d,s,u],n)}};async function getSvgAsImage(e,t){let{type:n,quality:r,scale:o}=t,l=+e.getAttribute("width"),a=+e.getAttribute("height"),s=l*o,i=a*o,c=await getSvgAsDataUrl(e),d=await getBrowserCanvasMaxSize();if(l>d.maxWidth&&(i=(s=d.maxWidth)/l*a),a>d.maxHeight&&(s=(i=d.maxHeight)/a*l),s*i>d.maxArea){let e=Math.sqrt(d.maxArea/(s*i));s*=e,i*=e}s=Math.floor(s),i=Math.floor(i);let u=s/l,m=await new Promise(e=>{let t=new Image;t.crossOrigin="anonymous",t.onload=async()=>{await new Promise(e=>setTimeout(e,250));let n=document.createElement("canvas"),r=n.getContext("2d");n.width=s,n.height=i,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(t,0,0,s,i),URL.revokeObjectURL(c),e(n)},t.onerror=()=>{e(null)},t.src=c});if(!m)return null;let h=await new Promise(e=>m.toBlob(t=>{t||e(null),e(t)},"image/".concat(n),r));if(!h)return null;let g=new DataView(await h.arrayBuffer());return PngHelpers.setPhysChunk(g,u,{type:"image/".concat(n)})}async function getSvgAsDataUrl(e){let t=e.cloneNode(!0);t.setAttribute("encoding",'UTF-8"');let n=new FileReader,r=Array.from(t.querySelectorAll("image"));for(let e of r){let t=e.getAttribute("xlink:href");if(t&&!t.startsWith("data:")){let r=await (await fetch(t)).blob(),o=await new Promise((e,t)=>{n.onload=()=>e(n.result),n.onerror=()=>t(n.error),n.readAsDataURL(r)});e.setAttribute("xlink:href",o)}}return getSvgAsDataUrlSync(t)}function getSvgAsDataUrlSync(e){let t=new XMLSerializer().serializeToString(e),n=window.btoa(unescape(encodeURIComponent(t)));return"data:image/svg+xml;base64,".concat(n)}n(81364);let w=a()(async()=>(await Promise.resolve().then(n.bind(n,55606))).Tldraw,{loadableGenerated:{webpack:()=>[null]},ssr:!1});function Home(){let[e,t]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let listener=e=>{"Escape"===e.key&&t(null)};return window.addEventListener("keydown",listener),()=>{window.removeEventListener("keydown",listener)}}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-screen h-screen",children:(0,r.jsxs)(w,{persistenceKey:"tldraw",children:[(0,r.jsx)(PromptSettingBtn,{}),(0,r.jsx)(ExportButton,{setCodeItem:t}),(0,r.jsx)(KeyAndApiSettingBtn,{}),(0,r.jsx)(HistoryPage,{})]})}),e&&i.createPortal((0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 bottom-0 flex justify-center items-center",style:{zIndex:2e3,backgroundColor:"rgba(0,0,0,0.5)"},onClick:()=>t(null),children:(0,r.jsx)(PreviewModal,{codeItem:e,onHandleClose:()=>{t(null)}})}),document.body)]})}function ExportButton(e){let{setCodeItem:t}=e,n=(0,o.useEditor)(),[l,a]=(0,s.useState)(!1),i=m(e=>e.addRecord);return(0,r.jsx)("button",{onClick:async e=>{a(!0);try{e.preventDefault();let r=await n.getSvg(Array.from(n.currentPageShapeIds));if(!r)return;let o=await getSvgAsImage(r,{type:"png",quality:1,scale:1}),l=await blobToBase64(o),a="";try{a=await getResponseFromAPI(l)}catch(e){console.log(e),alert("Error from open ai: ".concat(JSON.stringify(e.message)));return}let s=a,c=s.indexOf("<!DOCTYPE html>"),d=s.indexOf("</html>"),u=s.slice(c,d+7),m=new Date().toLocaleString();t({png:l,html:u,date:m}),i({png:l,html:u,date:m})}finally{a(!1)}},className:"fixed bottom-4 right-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded =",style:{zIndex:1e3},disabled:l,children:l?(0,r.jsx)("div",{className:"flex justify-center items-center ",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"})}):"生成代码"})}function HistoryPage(){let[e,t]=(0,s.useState)(!1),{history:n,loadHistory:o}=m();(0,s.useEffect)(()=>{o()},[]);let[l,a]=(0,s.useState)(null);return console.log(n,"storeHistory"),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{t(!0)},className:" z-[1000] fixed bottom-[188px] right-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded =",children:"历史记录"}),e&&(0,r.jsxs)("div",{className:"fixed top-0 left-0 right-0 bottom-0 flex flex-col justify-center items-center",style:{zIndex:2e3,backgroundColor:"rgba(0,0,0,0.5)"},children:[(0,r.jsx)("div",{className:"relative  overflow-auto  flex-wrap max-h-[600px]  bg-white w-[80%] h-1/2 flex",children:null==n?void 0:n.map((e,t)=>(0,r.jsxs)("div",{className:"w-[200px] flex flex-col items-center h-[200px] border shadow-slate-500 shadow-2xl m-3",children:[(0,r.jsx)("img",{src:e.png,className:"w-full h-full object-contain",alt:"",onClick:()=>{console.log("@@@@@"),a(e)}}),(0,r.jsx)("div",{children:null==e?void 0:e.date})]},t)).reverse()}),(0,r.jsx)("button",{onClick:()=>t(!1),className:"bg-red-400 mt-2 p-2 rounded-md hover:bg-gray-200 focus:outline-none focus:ring",children:"X关闭X"})]}),l&&i.createPortal((0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 bottom-0 flex justify-center items-center",style:{zIndex:2e3,backgroundColor:"rgba(0,0,0,0.5)"},onClick:()=>a(null),children:(0,r.jsx)(PreviewModal,{codeItem:l,onHandleClose:()=>a(null)})}),document.body)]})}function KeyAndApiSettingBtn(){let[e,t]=(0,s.useState)(!1),{setAiInfo:n,aiInfo:o}=m();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{t(!0)},className:" z-[1000] fixed bottom-[100px] right-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded =",children:"秘钥设置"}),e&&(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 bottom-0 flex justify-center items-center",style:{zIndex:2e3,backgroundColor:"rgba(0,0,0,0.5)"},children:(0,r.jsxs)("div",{className:"bg-white w-[400px] h-[400px] flex flex-col justify-center items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[(0,r.jsx)("label",{htmlFor:"",children:"代理地址"}),(0,r.jsx)("input",{id:"base_url",type:"text",className:"mb-3 border w-[300px] h-[40px] rounded-md",placeholder:"https://your-base-url/v1/chat/completions",defaultValue:o.base_url}),(0,r.jsx)("label",{htmlFor:"",children:"秘钥"}),(0,r.jsx)("input",{type:"text",id:"key",className:"border w-[300px] h-[40px] rounded-md",placeholder:"请输入秘钥",defaultValue:o.key})]}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("button",{onClick:()=>{let e=document.getElementById("base_url").value,r=document.getElementById("key").value;n({base_url:e,key:r}),t(!1)},className:"bg-blue-400 mt-2 mr-3 p-2 rounded-md hover:bg-gray-200 focus:outline-none focus:ring",children:"确定"}),(0,r.jsx)("button",{onClick:()=>t(!1),className:"bg-red-400 mt-2 p-2 rounded-md hover:bg-gray-200 focus:outline-none focus:ring",children:"关闭"})]})]})})]})}function PromptSettingBtn(){let[e,t]=(0,s.useState)(!1),{setAiInfo:n,aiInfo:o}=m();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{t(!0)},className:" z-[1000] fixed bottom-[338px] right-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded =",children:"prompt设置"}),e&&i.createPortal((0,r.jsxs)("div",{className:"fixed top-[30px] left-0 right-0 max-w-2xl mx-auto my-10 p-6 bg-white rounded-lg shadow",style:{zIndex:2e3},children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"system-prompt",className:"block text-gray-700 text-sm font-bold mb-2",children:"System Prompt:"}),(0,r.jsx)("textarea",{id:"system-prompt",placeholder:"输入",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline h-48",defaultValue:o.systemPrompt})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"user-input",className:"block text-gray-700 text-sm font-bold mb-2",children:"User:"}),(0,r.jsx)("textarea",{id:"user-input",placeholder:"输入",className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ",defaultValue:o.userPrompt})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>{let e=document.getElementById("system-prompt").value,r=document.getElementById("user-input").value;t(!1),n({userPrompt:r,systemPrompt:e})},children:"提交"}),(0,r.jsx)("button",{className:"bg-gray-200 hover:bg-gray-400 text-gray-700 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>t(!1),children:"取消"})]})]}),document.body)]})}}},function(e){e.O(0,[8155,3575,2971,2472,1744],function(){return e(e.s=22769)}),_N_E=e.O()}]);